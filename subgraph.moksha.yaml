specVersion: 0.0.9
description: Subgraph for DLPRoot, DataRegistry, VanaEpoch, DLPPerformance
repository: "https://github.com/vana-com/vana-subgraph"

schema:
  file: ./schema.graphql

# Stub for grafting on existing subgraphs
features:
  - grafting
graft:
  base: QmUKB4EiXUJRKVnR1pGHsULHw9WTGGmbzuCZ5EsvQQmsWe
  block: 3980000

dataSources:
  - kind: ethereum/contract
    name: Bootstrap
    network: moksha
    source:
      address: "0x0000000000000000000000000000000000000000" # dummy
      abi: Bootstrap
      startBlock: 655081
      endBlock: 655081
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Epoch
        - Dlp
      abis:
        - name: Bootstrap
          file: ./abis/v1/empty.json
      blockHandlers:
        - handler: handleBootstrap
      file: ./src/lib/entity/bootstrap/bootstrap.ts
# v1
  - kind: ethereum/contract
    name: DataRegistryImplementationV1
    network: moksha
    source:
      address: "0x8C8788f98385F6ba1adD4234e551ABba0f82Cb7C"
      abi: DataRegistryImplementationV1
      startBlock: 655081
      endBlock: 1019085
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - EpochReference
        - DataRegistryProof
      abis:
        - name: DataRegistryImplementationV1
          file: ./abis/v1/DataRegistryImplementation.json
      eventHandlers:
        - event: FileAdded(indexed uint256,indexed address,string)
          handler: handleFileAddedV1
        - event: ProofAdded(indexed uint256,indexed uint256)
          handler: handleDataRegistryProofAddedV1
      file: ./src/mapping.ts

# v2
  - kind: ethereum/contract
    name: DataRegistryImplementationV2
    network: moksha
    source:
      address: "0x8C8788f98385F6ba1adD4234e551ABba0f82Cb7C"
      abi: DataRegistryImplementationV2
      startBlock: 1019086
      endBlock: 1239930
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - EpochReference
        - DataRegistryProof
      abis:
        - name: DataRegistryImplementationV2
          file: ./abis/v2/DataRegistryImplementation.json
      eventHandlers:
        - event: FileAdded(indexed uint256,indexed address,string)
          handler: handleFileAddedV2
        - event: ProofAdded(indexed uint256,indexed uint256,indexed uint256,uint256)
          handler: handleDataRegistryProofAddedV2
      file: ./src/mapping.ts

# v3
  - kind: ethereum/contract
    name: DataRegistryImplementationV3
    network: moksha
    source:
      address: "0x8C8788f98385F6ba1adD4234e551ABba0f82Cb7C"
      abi: DataRegistryImplementationV3
      startBlock: 1239931
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - EpochReference
        - DataRegistryProof
      abis:
        - name: DataRegistryImplementationV3
          file: ./abis/v3/DataRegistryImplementation.json
      eventHandlers:
        - event: FileAdded(indexed uint256,indexed address,string)
          handler: handleFileAddedV3
        - event: FileAddedV2(indexed uint256,indexed address,string,uint256)
          handler: handleFileAddedV2V3
        - event: ProofAdded(indexed uint256,indexed address,uint256,indexed uint256,uint256,string)
          handler: handleDataRegistryProofAddedV3
      file: ./src/mapping.ts

#v5
  - kind: ethereum/contract
    name: QueryEngineImplementation
    network: moksha
    source:
      address: "0xd25Eb66EA2452cf3238A2eC6C1FD1B7F5B320490"
      abi: QueryEngineImplementation
      startBlock: 2208601
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - PaymentReceived
      abis:
        - name: QueryEngineImplementation
          file: ./abis/v4/QueryEngineImplementation.json
      eventHandlers:
        - event: PaymentReceived(indexed address,uint256,uint256,uint256)
          handler: handlePaymentReceived
      file: ./src/mapping.ts

  - kind: ethereum/contract
    name: DataRefinerRegistryImplementation
    network: moksha
    source:
      address: "0x93c3EF89369fDcf08Be159D9DeF0F18AB6Be008c"
      abi: DataRefinerRegistryImplementation
      startBlock: 2207166
      endBlock: 3477396
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Refiner
      abis:
        - name: DataRefinerRegistryImplementation
          file: ./abis/v4/DataRefinerRegistryImplementation.json
      eventHandlers:
        - event: RefinerAdded(indexed uint256,indexed uint256,string,string,string)
          handler: handleRefinerAddedV4
      file: ./src/mapping.ts

  - kind: ethereum/contract
    name: DLPRegistryImplementationV5
    network: moksha
    source:
      address: "0x4D59880a924526d1dD33260552Ff4328b1E18a43"
      abi: DLPRegistryImplementationV5
      startBlock: 2444992
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Dlp
        - DlpList
        - Params
      abis:
        - name: DLPRegistryImplementationV5
          file: ./abis/v5/DLPRegistryImplementation.json
      eventHandlers:
        - event: DlpRegistered(indexed uint256,indexed address,address,address,string,string,string,string)
          handler: handleDlpRegisteredV5
        - event: DlpUpdated(indexed uint256,indexed address,address,address,string,string,string,string)
          handler: handleDlpUpdatedV5
        - event: DlpStatusUpdated(indexed uint256,uint8)
          handler: handleDlpStatusUpdatedV5
        - event: DlpVerificationBlockUpdated(indexed uint256,uint256)
          handler: handleDlpVerificationBlockUpdatedV5
        - event: DlpTokenUpdated(indexed uint256,address)
          handler: handleDlpTokenUpdatedV5
      file: ./src/mapping.ts

  - kind: ethereum/contract
    name: VanaEpochImplementationV5
    network: moksha
    source:
      address: "0x2063cFF0609D59bCCc196E20Eb58A8696a6b15A0"
      abi: VanaEpochImplementationV5
      startBlock: 2445062
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Epoch
        - EpochReference
        - Params
      abis:
        - name: VanaEpochImplementationV5
          file: ./abis/v5/VanaEpochImplementation.json
      eventHandlers:
        - event: EpochCreated(uint256,uint256,uint256,uint256)
          handler: handleEpochCreatedV5
        - event: EpochDlpRewardAdded(uint256,uint256,uint256)
          handler: handleEpochDlpRewardAddedV5
        - event: EpochFinalized(uint256)
          handler: handleEpochFinalizedV5
        - event: EpochSizeUpdated(uint256)
          handler: handleEpochSizeUpdatedV5
        - event: EpochRewardAmountUpdated(uint256)
          handler: handleEpochRewardAmountUpdatedV5
      file: ./src/mapping.ts

  - kind: ethereum/contract
    name: DLPPerformanceImplementationV5
    network: moksha
    source:
      address: "0x847715C7DB37cF286611182Be0bD333cbfa29cc1"
      abi: DLPPerformanceImplementationV5
      startBlock: 2445086
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Epoch
        - Dlp
        - DlpPerformance
      abis:
        - name: DLPPerformanceImplementationV5
          file: ./abis/v5/DLPPerformanceImplementation.json
      eventHandlers:
        - event: EpochDlpPerformancesSaved(indexed uint256,indexed uint256,uint256,uint256,uint256,uint256)
          handler: handleEpochDlpPerformancesSavedV5
      file: ./src/mapping.ts

# v6
  - kind: ethereum/contract
    name: DataPortabilityGranteesImplementation
    network: moksha
    source:
      address: "0x8325C0A0948483EdA023A1A2Fd895e62C5131234"
      abi: DataPortabilityGranteesImplementation
      startBlock: 3608836
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Grantee
      abis:
        - name: DataPortabilityGranteesImplementation
          file: ./abis/v6/DataPortabilityGranteesImplementation.json
      eventHandlers:
        - event: GranteeRegistered(indexed uint256,indexed address,indexed address,string)
          handler: handleGranteeRegistered
      file: ./src/mapping.ts

  - kind: ethereum/contract
    name: DataPortabilityPermissionsImplementation
    network: moksha
    source:
      address: "0xD54523048AdD05b4d734aFaE7C68324Ebb7373eF"
      abi: DataPortabilityPermissionsImplementation
      startBlock: 3608836
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Permission
        - User
        - Grantee
      abis:
        - name: DataPortabilityPermissionsImplementation
          file: ./abis/v6/DataPortabilityPermissionsImplementation.json
      eventHandlers:
        - event: PermissionAdded(indexed uint256,indexed address,indexed uint256,string,uint256[])
          handler: handlePermissionAdded
        - event: PermissionRevoked(indexed uint256)
          handler: handlePermissionRevoked
      file: ./src/mapping.ts

  - kind: ethereum/contract
    name: DataPortabilityServersImplementation
    network: moksha
    source:
      address: "0x1483B1F634DBA75AeaE60da7f01A679aabd5ee2c"
      abi: DataPortabilityServersImplementation
      startBlock: 3608836
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Server
        - UserServer
        - User
      abis:
        - name: DataPortabilityServersImplementation
          file: ./abis/v6/DataPortabilityServersImplementation.json
      eventHandlers:
        - event: ServerRegistered(indexed uint256,indexed address,indexed address,bytes,string)
          handler: handleServerRegistered
        - event: ServerUpdated(indexed uint256,string)
          handler: handleServerUpdated
        - event: ServerTrusted(indexed address,indexed uint256)
          handler: handleServerTrusted
        - event: ServerUntrusted(indexed address,indexed uint256)
          handler: handleServerUntrusted
      file: ./src/mapping.ts

  - kind: ethereum/contract
    name: DataRefinerRegistryImplementationV6
    network: moksha
    source:
      address: "0x93c3EF89369fDcf08Be159D9DeF0F18AB6Be008c"
      abi: DataRefinerRegistryImplementationV6
      startBlock: 3477397
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Refiner
        - Schema
      abis:
        - name: DataRefinerRegistryImplementationV6
          file: ./abis/v6/DataRefinerRegistryImplementation.json
      eventHandlers:
        - event: RefinerAdded(indexed uint256,indexed uint256,string,indexed uint256,string,string)
          handler: handleRefinerAddedV6
        - event: SchemaAdded(indexed uint256,string,string,string)
          handler: handleSchemaAdded
      file: ./src/mapping.ts


# unuiswap
  - kind: ethereum/contract
    name: Factory
    network: moksha
    source:
      address: "0x7067Eb594d6dc6a5AD33c3fcFCa7183F369bC2e8"
      abi: Factory
      startBlock: 596576
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Pool
        - Token
      abis:
        - name: Factory
          file: ./abis/uniswap/factory.json
        - name: ERC20
          file: ./abis/uniswap/ERC20.json
        - name: ERC20SymbolBytes
          file: ./abis/uniswap/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ./abis/uniswap/ERC20NameBytes.json
        - name: Pool
          file: ./abis/uniswap/pool.json
      eventHandlers:
        - event: PoolCreated(indexed address,indexed address,indexed uint24,int24,address)
          handler: handlePoolCreated
      file: ./src/mapping.ts

templates:
  - kind: ethereum/contract
    name: Pool
    network: moksha
    source:
      abi: Pool
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Pool
        - Token
      abis:
        - name: Pool
          file: ./abis/uniswap/pool.json
        - name: Factory
          file: ./abis/uniswap/factory.json
        - name: ERC20
          file: ./abis/uniswap/ERC20.json
      eventHandlers:
        - event: Initialize(uint160,int24)
          handler: handleInitialize
        - event: Swap(indexed address,indexed address,int256,int256,uint160,uint128,int24)
          handler: handleSwap
        - event: Mint(address,indexed address,indexed int24,indexed
            int24,uint128,uint256,uint256)
          handler: handleMint
        - event: Burn(indexed address,indexed int24,indexed int24,uint128,uint256,uint256)
          handler: handleBurn
        - event: Collect(indexed address,address,indexed int24,indexed
            int24,uint128,uint128)
          handler: handleCollect
      file: ./src/mapping.ts